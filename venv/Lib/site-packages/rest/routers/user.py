from typing import List

from fastapi import APIRouter
from fastapi import Depends

from rest.cognito.auth import get_current_user, get_authorizations
from rest.cognito.authorizations import Authorizations
from rest.models import Workflow
from rest.models.user_profile import UserProfile
from rest.tailor_lib_client import TailorLibClient
from tailor.internal.utils import get_default_project

router = APIRouter()

project_name = get_default_project()
tailor_lib = TailorLibClient(project_name)


@router.get("/profile",
            summary="The profile information for the specified user",
            response_model=UserProfile,
            response_model_exclude_none=True)
async def profile(
        username: str = Depends(get_current_user)) -> UserProfile:
    return tailor_lib.find_user_by_username(username)

@router.get("/workflows",
            summary="The workflows created by the current user",
            response_model=List[Workflow],
            response_model_exclude_none=True)
async def profile(
        authorizations: Authorizations = Depends(
            get_authorizations)) -> List[Workflow]:
    return tailor_lib.find_workflows_for_user(authorizations.user)
